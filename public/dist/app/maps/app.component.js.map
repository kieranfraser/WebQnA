{"version":3,"sources":["app.component.ts"],"names":[],"mappings":"AAAA;;;;GAIG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YA8CH;gBAyCI,sBAAoB,OAAc,EAAS,IAAU,EAAS,QAAkB,EAC5D,WAAwB;oBADxB,YAAO,GAAP,OAAO,CAAO;oBAAS,SAAI,GAAJ,IAAI,CAAM;oBAAS,aAAQ,GAAR,QAAQ,CAAU;oBAC5D,gBAAW,GAAX,WAAW,CAAa;oBAxC5C;;;;;;;;uBAQG;oBACH,YAAO,GAAG;wBACN,oBAAoB;wBACpB,YAAY,EAAE,OAAO;wBACrB,IAAI,EAAE,kDAAkD;wBACxD,IAAI,EAAE;4BACF,MAAM,EAAE;gCACJ,KAAK,EAAE,aAAa;6BACvB;yBACJ;qBACJ,CAAC;oBAEF;;;uBAGG;oBACH,SAAI,GAAG,IAAI,SAAS,CAAC,kCAAkC,EAAE,oBAAoB,CAAC,CAAC;oBAC/E,SAAI,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;oBAC7B,cAAS,GAAc,IAAI,wBAAS,EAAE,CAAC;oBAGvC;;;uBAGG;oBACK,iBAAY,GAAY,KAAK,CAAC;oBAItC,WAAM,GAAG,IAAI,CAAC;oBAIV,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;gBAC1B,CAAC;gBAED;;;;mBAIG;gBACH,+BAAQ,GAAR;oBACI,OAAO,CAAC,GAAG,CAAC,4CAA4C,CAAC,CAAC;oBAC1D,EAAE,CAAA,CAAC,8BAAe,EAAE,CAAC,CAAA,CAAC;wBAClB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;wBACzB,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;oBACxC,CAAC;gBACL,CAAC;gBAED;;;;;;;;;;mBAUG;gBACH,4BAAK,GAAL;oBAAA,iBAuBC;oBAtBG,OAAO,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;oBAC5C,mCAAmC;oBACnC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAC,UAAC,GAAW,EAAE,OAAe,EAAE,QAAgB;wBACvE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;4BACN,MAAM,IAAI,KAAK,CAAC,GAAG,CAAC,CAAC;wBACzB,CAAC;wBAED,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;wBACzD,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;wBAC3C,OAAO,CAAC,GAAG,CACP,KAAI,CAAC,SAAS,CAAC,WAAW,CAAC,QAAQ,CAAC,EACpC,KAAI,CAAC,SAAS,CAAC,sBAAsB,CAAC,QAAQ,CAAC,CAClD,CAAC;wBACF,IAAI,MAAM,GAAW,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC;wBAEzE,mEAAmE;wBACnE,KAAI,CAAC,WAAW,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,SAAS,CAC7C,UAAA,IAAI,IAAI,OAAA,YAAY,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,EAAlD,CAAkD,EAC1D,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,KAAK,CAAC,EAAZ,CAAY,EACrB,cAAM,OAAA,KAAI,CAAC,mBAAmB,EAAE,EAA1B,CAA0B,CACnC,CAAC;oBACN,CAAC,CAAC,CAAC;gBACP,CAAC;gBAED,0CAAmB,GAAnB;oBACI,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;oBACxC,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;oBAC/D,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACjE,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;oBAClE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;oBACzB,OAAO,CAAC,GAAG,CAAC,iDAAiD,CAAC,CAAC;oBAC/D,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;gBACzC,CAAC;gBAED;;;;mBAIG;gBACH,6BAAM,GAAN;oBACI,OAAO,CAAC,GAAG,CAAC,gDAAgD,CAAC,CAAC;oBAC9D,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;oBACpF,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;oBACnC,YAAY,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;oBACpC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;oBAC1B,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;gBACvC,CAAC;gBAED;;;;mBAIG;gBACH,mCAAY,GAAZ;oBACI,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;gBAC9B,CAAC;gBAED;;;;mBAIG;gBACH,kCAAW,GAAX;oBACI,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;oBACzB,IAAI,CAAC,WAAW,GAAI,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,OAAO,CAAC;gBAC5E,CAAC;gBAED;;mBAEG;gBACH,+BAAQ,GAAR;oBACI,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;yBACjB,SAAS,CACN,UAAA,IAAI,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAxB,CAAwB,EAChC,UAAA,GAAG,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAhB,CAAgB,EACvB,cAAM,OAAA,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,EAAvB,CAAuB,CAChC,CAAC;gBACV,CAAC;gBAED;;;mBAGG;gBACH,qCAAc,GAAd;oBACI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,eAAe,CAAC;yBAC7B,SAAS,CACN,UAAA,IAAI,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAxB,CAAwB,EAChC,UAAA,GAAG,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAhB,CAAgB,EACvB,cAAM,OAAA,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,EAAvB,CAAuB,CAChC,CAAC;gBACV,CAAC;gBAED;;mBAEG;gBACH,wCAAiB,GAAjB;oBACI,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,SAAS,CAC/B,UAAA,IAAI,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAjB,CAAiB,EACzB,UAAA,GAAG,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,EAAhB,CAAgB,EACvB,cAAM,OAAA,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,EAAvB,CAAuB,CAChC,CAAC;gBACN,CAAC;gBAED;;;;;mBAKG;gBACH,mCAAY,GAAZ;oBACI,IAAI,KAAK,GAAG,YAAY,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;oBAE7C,OAAO,CAAC,GAAG,CACP,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,KAAK,CAAC,EACjC,IAAI,CAAC,SAAS,CAAC,sBAAsB,CAAC,KAAK,CAAC,EAC5C,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,CACvC,CAAC;gBACN,CAAC;gBArNL;oBAAC,gBAAS,CAAC;wBACP,QAAQ,EAAE,KAAK;wBACf,SAAS,EAAE,CAAC,0BAAW,CAAC;qBAC3B,CAAC;oBAED,WAAI,CAAC;wBACF,UAAU,EAAE,CAAE,0BAAiB,EAAE,wCAAkB,EAAE,qBAAK,CAAC;wBAC3D,WAAW,EAAE,gBAAgB;qBAChC,CAAC;oBAOD,oBAAW,CAAC;wBACT,EAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,oCAAgB,EAAE,YAAY,EAAE,IAAI,EAAC;wBAC7E,EAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE,OAAO,EAAE,SAAS,EAAE,gCAAc,EAAC;wBAC1D,EAAC,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,SAAS,EAAE,wCAAkB,EAAC;qBACpE,CAAC;;gCAAA;gBAmMF,mBAAC;YAAD,CA7LA,AA6LC,IAAA;YA7LD,uCA6LC,CAAA","file":"app.component.js","sourcesContent":["/**\r\n * Important! - when using ng2-bootstrap library, this reference path\r\n * tag must be added to the top of the component implementing the feature\r\n * in order for the typescript to compile. (Gulp will throw an error otherwise).\r\n */\r\n\r\n/// <reference path=\"../typings/browser/definitions/moment/moment.d.ts\" />\r\n\r\nimport {DashboardComponent} from \"./dashboard.component\";\r\nimport {Component, View, provide, OnInit} from 'angular2/core';\r\nimport {RouteConfig, Router, APP_BASE_HREF, ROUTER_PROVIDERS, ROUTER_DIRECTIVES, CanActivate, OnActivate, ComponentInstruction} from 'angular2/router';\r\nimport {HTTP_PROVIDERS, Http} from 'angular2/http';\r\nimport {LandingComponent} from \"./landing.component\";\r\nimport {AboutComponent} from \"./about.component\";\r\nimport {AuthHttp, AuthConfig, tokenNotExpired, JwtHelper} from 'angular2-jwt';\r\nimport {Alert} from 'ng2-bootstrap/ng2-bootstrap';\r\nimport {HTTPService} from \"./services/http-service\";\r\n\r\n/**\r\n * Auth0Lock provided by Auth0. Controls the user interface for SSO.\r\n * see https://github.com/auth0/lock for details.\r\n */\r\ndeclare var Auth0Lock;\r\ndeclare var io: any;\r\n\r\n@Component({\r\n    selector: 'app',\r\n    providers: [HTTPService]\r\n})\r\n\r\n@View({\r\n    directives: [ ROUTER_DIRECTIVES, DashboardComponent, Alert],\r\n    templateUrl: 'views/app.html'\r\n})\r\n\r\n/**\r\n * These are the possible routes from the app.component. The landing page is set as default.\r\n * It also implements Auth0 for SSO via the login button (as pop up).\r\n * There is also a user metrics dashboard with the implementation - useful!\r\n */\r\n@RouteConfig([\r\n    {path: '/', name: 'Landing', component: LandingComponent, useAsDefault: true},\r\n    {path: '/about', name: 'About', component: AboutComponent},\r\n    {path: '/dash', name: 'Dashboard', component: DashboardComponent}\r\n])\r\n\r\n/**\r\n * This is the landing page component. Mainly managing the nav bar elements\r\n * and checking whether or not a user is already logged in to a session.\r\n */\r\nexport class AppComponent implements OnInit {\r\n\r\n    /**\r\n     * Using the Lock interface with these options means it's embeddable in the page. The\r\n     * other option is the show() the Lock interface as a pop-up.\r\n     * ToDo: (Low priority) Decide which is better, the pop-up or the embedded version.\r\n     * The token response is the JWT necessary for user authentication throughout the application\r\n     * when navigating to routes with the @canActivate restriction and also necessary for Auth0\r\n     * api requests.\r\n     * @type {{container: string, responseType: string}}\r\n     */\r\n    options = {\r\n        //container: 'root',\r\n        responseType: 'token',\r\n        icon: '/images/ico/apple-touch-icon-144-precomposed.png',\r\n        dict: {\r\n            signin: {\r\n                title: \"Qanda Login\"\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * The lock instantiation requires the client id and domain respectively.\r\n     * ToDo: These hardcoded authentication values need to be removed from GitHub!\r\n     */\r\n    lock = new Auth0Lock('deuLbU0yLQDPCVHPaDrT8cA61JB8PCZ5', 'qanda.eu.auth0.com');\r\n    hash = this.lock.parseHash();\r\n    jwtHelper: JwtHelper = new JwtHelper();\r\n    thing: string;\r\n\r\n    /**\r\n     * The boolean which controls the login/logout button on the nav bar\r\n     * @type {boolean}\r\n     */\r\n    public  userLoggedIn: boolean = false;\r\n    public userProfile;\r\n\r\n\r\n    socket = null;\r\n\r\n    constructor(private _router:Router, public http: Http, public authHttp: AuthHttp,\r\n                private httpService: HTTPService) {\r\n        this.socket = io('/');\r\n    }\r\n\r\n    /**\r\n     * On init must check if the user is logged in:\r\n     * ToDo: redirect to the dashboard if the user is already logged in.\r\n     *\r\n     */\r\n    ngOnInit() {\r\n        console.log('Checking if the user is logged in on init.');\r\n        if(tokenNotExpired()){\r\n            this.userLoggedIn = true;\r\n            this._router.navigateByUrl('/dash');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Function fired when the login button is pressed.\r\n     *\r\n     * Setting up the Lock UI\r\n     * The lock.show() function sends the user's log-in details to the\r\n     * Auth0 service securely (using OAuth2/ OpenID connect)\r\n     * The response of the post request is a JWT and user profile details.\r\n     * These are stored in localStorage for later use.\r\n     * User then redirected to the dashboardComponent (child component of\r\n     * app.component)\r\n     */\r\n    login(){\r\n        console.log(\"Initializing the Auth0 form.\");\r\n        //this._parent.userLoggedIn = true;\r\n        this.lock.show(this.options,(err: string, profile: string, id_token: string) => {\r\n            if (err) {\r\n                throw new Error(err);\r\n            }\r\n\r\n            localStorage.setItem('profile', JSON.stringify(profile));\r\n            localStorage.setItem('id_token', id_token);\r\n            console.log(\r\n                this.jwtHelper.decodeToken(id_token),\r\n                this.jwtHelper.getTokenExpirationDate(id_token)\r\n            );\r\n            var userId: string = JSON.parse(localStorage.getItem('profile')).user_id;\r\n\r\n            // Get user details (joined classes, questions asked) from database\r\n            this.httpService.getUserDetails(userId).subscribe(\r\n                data => localStorage.setItem('user', JSON.stringify(data)),\r\n                error => alert(error),\r\n                () => this.navigateToDashboard()\r\n            );\r\n        });\r\n    }\r\n\r\n    navigateToDashboard(){\r\n        console.log(\"get user details failure\");\r\n        console.log((JSON.parse(localStorage.getItem('user')).userid));\r\n        console.log((JSON.parse(localStorage.getItem('user')).lectures));\r\n        console.log((JSON.parse(localStorage.getItem('user')).questions));\r\n        this.userLoggedIn = true;\r\n        console.log(\"Login successful, redirecting to the dashboard.\");\r\n        this._router.navigate(['Dashboard']);\r\n    }\r\n\r\n    /**\r\n     * Function fired when the logout button is pressed. Deletes the user's JWT\r\n     * and profile from local storage, sets the logged in boolean as false so the\r\n     * login button is redisplayed and redirects to the landing page of the site.\r\n     */\r\n    logout() {\r\n        console.log('User has logged out. Redirect to landing page.');\r\n        this.socket.emit('userLogout', JSON.parse(localStorage.getItem('profile')).user_id);\r\n        localStorage.removeItem('profile');\r\n        localStorage.removeItem('id_token');\r\n        this.userLoggedIn = false;\r\n        this._router.navigate(['Landing']);\r\n    }\r\n\r\n    /**\r\n     * Utility function to change the state of the userLoggedIn\r\n     * boolean which controls the state of the Login/Logout buttons\r\n     * on the nav bar. This\r\n     */\r\n    setLoggedOut(){\r\n        this.userLoggedIn = false;\r\n    }\r\n\r\n    /**\r\n     * Utility function to change the state of the userLoggedIn\r\n     * boolean which controls the state of the Login/Logout buttons\r\n     * on the nav bar. This\r\n     */\r\n    setLoggedIn(){\r\n        this.userLoggedIn = true;\r\n        this.userProfile  = JSON.parse(localStorage.getItem('profile')).picture;\r\n    }\r\n\r\n    /**\r\n     * Non-Authenticated api request example\r\n     */\r\n    getThing() {\r\n        this.http.get('/ping')\r\n            .subscribe(\r\n                data => console.log(data.json()),\r\n                err => console.log(err),\r\n                () => console.log('Complete')\r\n            );\r\n    }\r\n\r\n    /**\r\n     * Authenticated api request example:\r\n     * ToDo: Save the user's id in the database - api request to express route\r\n     */\r\n    getSecretThing() {\r\n        this.authHttp.get('/secured/ping')\r\n            .subscribe(\r\n                data => console.log(data.json()),\r\n                err => console.log(err),\r\n                () => console.log('Complete')\r\n            );\r\n    }\r\n\r\n    /**\r\n     * Not sure what this does yet.. will come back to it!\r\n     */\r\n    tokenSubscription() {\r\n        this.authHttp.tokenStream.subscribe(\r\n            data => console.log(data),\r\n            err => console.log(err),\r\n            () => console.log('Complete')\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Helper method for getting the JWT from storage and getting\r\n     * various details from it such as the expiration etc.\r\n     * Can call for a refresh of the token if going to be expired and\r\n     * user is still logged in - ToDo: Refresh token\r\n     */\r\n    useJwtHelper() {\r\n        var token = localStorage.getItem('id_token');\r\n\r\n        console.log(\r\n            this.jwtHelper.decodeToken(token),\r\n            this.jwtHelper.getTokenExpirationDate(token),\r\n            this.jwtHelper.isTokenExpired(token)\r\n        );\r\n    }\r\n}"],"sourceRoot":"/source/"}
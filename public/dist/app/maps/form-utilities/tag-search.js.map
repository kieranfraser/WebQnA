{"version":3,"sources":["form-utilities/tag-search.ts"],"names":[],"mappings":"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","file":"form-utilities/tag-search.js","sourcesContent":["/**\r\n * Created by kfraser on 18/03/2016.\r\n */\r\nimport {Component, View} from 'angular2/core';\r\nimport {CORE_DIRECTIVES, FORM_DIRECTIVES} from 'angular2/common';\r\nimport {Alert, DROPDOWN_DIRECTIVES} from \"ng2-bootstrap/ng2-bootstrap\";\r\nimport {TYPEAHEAD_DIRECTIVES} from 'ng2-bootstrap/ng2-bootstrap';\r\nimport {ClassInputComponent} from \"../class-input.component\";\r\nimport {DashboardComponent} from \"../dashboard.component\";\r\nimport {forwardRef} from \"angular2/core\";\r\nimport {Inject} from \"angular2/core\";\r\n\r\n@Component({\r\n    selector: 'tag-search',\r\n    inputs: ['tags'],\r\n})\r\n\r\n@View({\r\n    templateUrl: 'views/form-utilities/tag_search.html',\r\n    directives: [TYPEAHEAD_DIRECTIVES, FORM_DIRECTIVES, CORE_DIRECTIVES]\r\n})\r\n\r\n/**\r\n * The form to create a new class. TODO: User has an auth field\r\n * TODO: this is so the lecturers and students can be distinguished - only give\r\n * TODO: the lecturers the power to use this component.\r\n */\r\nexport class TagSearchComponent{\r\n\r\n    /**\r\n     * Typeahead and tag input\r\n     */\r\n\r\n    private selected:string = '';\r\n    private asyncSelected:string = '';\r\n    private typeaheadLoading:boolean = false;\r\n    private typeaheadNoResults:boolean = false;\r\n\r\n\r\n    tags: string[];\r\n\r\n    private states:Array<string> = [];\r\n\r\n    private statesComplex:Array<any> = [];\r\n\r\n    private getContext() {\r\n        return this;\r\n    }\r\n\r\n    private _cache:any;\r\n    private _prevContext:any;\r\n\r\n    constructor(@Inject(forwardRef(() => DashboardComponent)) private _parent:DashboardComponent) {}\r\n\r\n    private getAsyncData(context:any):Function {\r\n        if (this._prevContext === context) {\r\n            return this._cache;\r\n        }\r\n\r\n        this._prevContext = context;\r\n        let f:Function = function ():Promise<string[]> {\r\n            let p:Promise<string[]> = new Promise((resolve:Function) => {\r\n                setTimeout(() => {\r\n                    let query = new RegExp(context.asyncSelected, 'ig');\r\n                    return resolve(context.states.filter((state:any) => {\r\n                        return query.test(state);\r\n                    }));\r\n                }, 200);\r\n            });\r\n            return p;\r\n        };\r\n        this._cache = f;\r\n        return this._cache;\r\n    }\r\n\r\n    private changeTypeaheadLoading(e:boolean) {\r\n        this.typeaheadLoading = e;\r\n    }\r\n\r\n    private changeTypeaheadNoResults(e:boolean) {\r\n        this.typeaheadNoResults = e;\r\n    }\r\n\r\n    private typeaheadOnSelect(e:any) {\r\n        console.log(`Selected value: ${e.item}`);\r\n    }\r\n\r\n    onKey(value){\r\n        if(value.code === 'Comma'){\r\n            var newTag: string = this.selected.substring(0, this.selected.length-1);\r\n            var index = this.tags.indexOf(newTag, 0);\r\n            if (index === -1) {\r\n                this.tags.push(newTag);\r\n                this.addToTypeahead(newTag);\r\n                this.selected = '';\r\n                this._parent.updateTagSearchFilter(0);\r\n            }\r\n        }\r\n\r\n        if(value.code === 'Enter'){\r\n            return false;\r\n        }\r\n    }\r\n\r\n    addToTypeahead(newTag: string){\r\n        var index = this.states.indexOf(newTag, 0);\r\n        if (index === -1) {\r\n            this.states.push(newTag);\r\n            this.statesComplex = [];\r\n            var counter:number = 1;\r\n            for (var state of this.states) {\r\n                this.statesComplex.push({id: counter, name: state});\r\n                counter++;\r\n            }\r\n        }\r\n    }\r\n\r\n    removeTag(tag:string){\r\n        var index = this.tags.indexOf(tag, 0);\r\n        if (index > -1) {\r\n            this.tags.splice(index, 1);\r\n        }\r\n        index = this.states.indexOf(tag, 0);\r\n        if (index > -1) {\r\n            this.states.splice(index, 1);\r\n        }\r\n        var result = this.statesComplex.filter(function( obj ) {\r\n            return obj.name == tag; })[0];\r\n        this.statesComplex.splice(result.id-1, 1);\r\n        this._parent.updateTagSearchFilter(0);\r\n    }\r\n}\r\n\r\n"],"sourceRoot":"/source/"}